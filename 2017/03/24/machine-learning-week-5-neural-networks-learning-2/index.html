
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Machine learning week 5 - Neural Networks: Learning</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Machine learning week 5 - Neural Networks: Learning">
    <meta name="twitter:description" content="">

    <meta property="og:url" content="http://localhost:2368">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Machine learning week 5 - Neural Networks: Learning">
    <meta property="og:description" content="">
    <meta property="og:site_name" content="Dong Liang's Blog">

    <meta itemprop="name" content="Machine learning week 5 - Neural Networks: Learning">
    <meta itemprop="description" content="">

    <meta name="twitter:site" content="@yourblogtwitter">

<meta name="twitter:creator" content="@yourtwitter">

<meta property="article:author" content="https://www.facebook.com/yourprofile">

<meta property="article:publisher" content="https://www.facebook.com/yourblogprofile">

<meta property="fb:admins" content="">

<meta name="google-site-verification" content="">

<link rel="author" href="https://plus.google.com/yourprofile">

<meta name="theme-color" content="">

    <link href="../../../../favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="../../../../apple-touch-icon-precomposed.png" rel="apple-touch-icon">

    <link href="http://fonts.googleapis.com/" rel="dns-prefetch">
    <link href="http://fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic%7COpen+Sans:700,400&amp;subset=latin,latin-ext" rel="stylesheet">

    <link rel="stylesheet" href="../../../../assets/css/main.min.css?v=3e6e4834d0">

    <script type="text/javascript">
      var ga_ua = 'UA-XXXXX-X';

var disqus_shortname = 'example';

var enable_pjax = true;

      // Pace Options
      // ==============
      window.paceOptions = {
        catchupTime: 100,
        minTime: 100,
        elements: false,
        restartOnRequestAfter: 500,
        startOnPageLoad: false
      }

      // Ghostium Globals
      // ==============
      window.GHOSTIUM = {};
      GHOSTIUM.haveGA = typeof ga_ua !== 'undefined' && ga_ua !== 'UA-XXXXX-X';
      GHOSTIUM.haveDisqus = typeof disqus_shortname !== 'undefined' && disqus_shortname !== 'example';
      GHOSTIUM.enablePjax = typeof enable_pjax !== 'undefined' ? enable_pjax : true;
    </script>

    <script src="../../../../assets/js/head-scripts.min.js?v=3e6e4834d0"></script>

    <link rel="canonical" href="index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="amp/index.html">
    
    <meta property="og:site_name" content="Dong Liang's Blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Machine learning week 5 - Neural Networks: Learning">
    <meta property="og:description" content="Cost Function Neural network model Let's first define a few variables that we will need to use: L = total number of layers in the network sl = number of units (not counting bias unit) in layer l K = number of output units/classes Cost function Note: the double sum simply adds">
    <meta property="og:url" content="http://localhost:2368/2017/03/24/machine-learning-week-5-neural-networks-learning-2/">
    <meta property="article:published_time" content="2017-03-24T07:41:30.000Z">
    <meta property="article:modified_time" content="2017-04-13T02:49:54.000Z">
    <meta property="article:tag" content="machine learning">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Machine learning week 5 - Neural Networks: Learning">
    <meta name="twitter:description" content="Cost Function Neural network model Let's first define a few variables that we will need to use: L = total number of layers in the network sl = number of units (not counting bias unit) in layer l K = number of output units/classes Cost function Note: the double sum simply adds">
    <meta name="twitter:url" content="http://localhost:2368/2017/03/24/machine-learning-week-5-neural-networks-learning-2/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Dong Liang">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="machine learning">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Dong Liang&#x27;s Blog",
        "logo": "http://localhost:2368/ghost/img/ghosticon.jpg"
    },
    "author": {
        "@type": "Person",
        "name": "Dong Liang",
        "url": "http://localhost:2368/author/dong/",
        "sameAs": []
    },
    "headline": "Machine learning week 5 - Neural Networks: Learning",
    "url": "http://localhost:2368/2017/03/24/machine-learning-week-5-neural-networks-learning-2/",
    "datePublished": "2017-03-24T07:41:30.000Z",
    "dateModified": "2017-04-13T02:49:54.000Z",
    "keywords": "machine learning",
    "description": "Cost Function Neural network model Let&#x27;s first define a few variables that we will need to use: L &#x3D; total number of layers in the network sl &#x3D; number of units (not counting bias unit) in layer l K &#x3D; number of output units/classes Cost function Note: the double sum simply adds",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368"
    }
}
    </script>

    <script type="text/javascript" src="../../../../shared/ghost-url.js?v=3e6e4834d0"></script>
<script type="text/javascript">
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "25d5f7346569"
});
</script>
    <meta name="generator" content="Ghost 0.11">
    <link rel="alternate" type="application/rss+xml" title="Dong Liang's Blog" href="../../../../rss/index.html">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/github.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body class="post-template tag-machine-learning">

    <button data-action="open-drawer" id="drawer-button" class="drawer-button"><i class="fa fa-bars"></i></button>
<nav tabindex="-1" class="drawer">
  <div class="drawer-container">
    <!--.drawer-search(role="search")-->
    <ul role="navigation" class="drawer-list">
      
<li class="drawer-list-item">
  <a href="../../../../" data-pjax>
    <i class="fa fa-home"></i>Home
  </a>
</li>
<li class="drawer-list-item">
  <a href="../../../../rss/index.rss">
    <i class="fa fa-rss"></i>Subscribe to Feed
  </a>
</li>
<li class="drawer-list-divider">
<li class="drawer-list-item drawer-list-title">
  Follow me
</li>
<li class="drawer-list-item">
  <a href="http://twitter.com" target="_blank">
    <i class="fa fa-twitter"></i>Twitter
  </a>
</li>
<li class="drawer-list-item">
  <a href="http://github.com" target="_blank">
    <i class="fa fa-github"></i>Github
  </a>
</li>
    </ul>
  </div>
</nav>

    <div class="drawer-overlay"></div>
    <main id="container" role="main" class="container">
      <div class="surface">
        <div class="surface-container">
          <div data-pjax-container class="content">
            
<section class="wrapper wrapper-post">
  <div class="wrapper-container">
    <article itemscope itemtype="http://schema.org/BlogPosting" role="article" class="post post tag-machine-learning featured">
        <section class="post-container">
          <header class="post-header">
            <ul class="post-meta-list">
              <li class="post-meta-item">
                <time datetime="2017-03-24" itemprop="datePublished">
                  5 months ago
                </time>
              </li>
                <li class="post-meta-item">
                    <a itemprop="articleSection" href="../../../../tag/machine-learning/" data-pjax>machine learning</a> 
                </li>
              <li class="post-meta-item">
                <a href="index.html#disqus_thread" data-disqus-identifier="9">Comments</a>
              </li>
            </ul>
            <h1 itemprop="name headline" class="post-title"><a href="index.html" itemprop="url" data-pjax title="Machine learning week 5 - Neural Networks: Learning">Machine learning week 5 - Neural Networks: Learning</a></h1>
            <!--h2 itemprop="about" class="post-subtitle"></h2-->
          </header>
          <aside class="post-side">
            <div class="post-author">
              <div class="post-author-info">
                <a href="index.html" class="post-author-name">
                  Dong Liang
                </a>
                <p class="post-author-bio"></p>
              </div>
            </div>
          </aside>
          <div itemprop="articleBody" class="post-body">
            <h3 id="costfunction">Cost Function</h3>

<p><strong>Neural network model</strong>
<img src="http://7d9rd6.com1.z0.glb.clouddn.com/wp-content/uploads/2016/04/scrn20160408215047.png" alt="neural network"></p>

<p>Let's first define a few variables that we will need to use:</p>

<ul>
<li>L = total number of layers in the network</li>
<li>sl = number of units (not counting bias unit) in layer l</li>
<li>K = number of output units/classes</li>
</ul>

<p><mark><strong>Cost function</strong></mark></p>

<p><img src="../../../../content/images/2017/03/Screen-Shot-2017-03-24-at-1.54.34-AM.png" alt="cost function"></p>

<p><strong><em>Note:</em></strong></p>

<ul>
<li>the double sum simply adds up the logistic regression costs calculated for each cell in the output layer</li>
<li>the triple sum simply adds up the squares of all the individual Θs in the entire network.</li>
<li>the i in the triple sum does not refer to training example i</li>
</ul>

<hr>

<h3 id="backpropagationalgorithm">Backpropagation Algorithm</h3>

<blockquote>
  <p>"Backpropagation" is neural-network terminology for minimizing our cost function. The goal of Backpropagation is to minimize J(theta) - the cost function of NN, using an optimal set of parameters in theta: namely minΘJ(Θ).</p>
</blockquote>

<p><strong>Backpropagation Intuition</strong></p>

<p><img src="../../../../content/images/2017/03/Screen-Shot-2017-03-31-at-3.35.53-PM.png" alt=""></p>

<p><em>*The δ(l)j is the error for a(l)j, expressed as the derivative of the cost function.The derivative is the slope of a line tangent to the cost fucntion, so the steeper the slope the more incorrect we are. *</em></p>

<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/qc309rdcEea4MxKdJPaTxA_324034f1a3c3a3be8e7c6cfca90d3445_fixx.png?expiry=1491091200000&amp;hmac=xP_kro6Z8DjXgkDS6Fldh99xn4GgBdcP0ffsNj7UUMs" alt=""></p>

<p>In the image above, to calculate δ(2)2, we multiply the weights Θ(2)12 and Θ(2)22 by their respective δ values found to the right of each edge. So we get δ(2)2= Θ(2)12<em>δ(3)1+Θ(2)22</em>δ(3)2. To calculate every single possible δ(l)j, we could start from the right of our diagram. We can think of our edges as our Θij. Going from right to left, to calculate the value of δ(l)j, you can just take the over all sum of each weight times the δ it is coming from. Hence, another example would be δ(3)2=Θ(3)12*δ(4)1.</p>

<hr>

<h3 id="unrollingparameters">Unrolling Parameters</h3>

<ul>
<li>It becomes more convenient when the theta or gradient parameters are packed into a bigger matrix, facilitating the vectorized operations. </li>
<li>Unrolling matrix of parameters and putting them into one long vector before using the optimizing function such as fminunc(). </li>
</ul>

<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/kdK7ubT2EeajLxLfjQiSjg_d35545b8d6b6940e8577b5a8d75c8657_Screenshot-2016-11-27-15.09.24.png?expiry=1491004800000&amp;hmac=qh2Gn1mRQ-khB5O2476dP0dkmXPypNn46ODoxmTmvHM" alt=""></p>

<hr>

<h3 id="gradientchecking">Gradient Checking</h3>

<p>Gradient Checking is designed to ensure that the deltaVector function works as intended. We can approximate the derivative of the cost function J(theta). </p>

<p>The approximation can be implemented by adding or subtracting epsilon to the theta matrix, as shown in octave codes as follows:</p>

<pre><code>epsilon = 1e-4;  
for i = 1:n,  
  thetaPlus = theta;
  thetaPlus(i) += epsilon;
  thetaMinus = theta;
  thetaMinus(i) -= epsilon;
  gradApprox(i) = (J(thetaPlus) - J(thetaMinus))/(2*epsilon)
end;  
</code></pre>

<hr>

<h3 id="randominitialization">Random Initialization</h3>

<p>The use of all-zero matrix for parameters initialization would result in repeated updating to the same values in all nodes during backpropagation. Random initialization of weights for theta matrix circumvent the problem of symmetry breaking.</p>

<p>Initializing weights with zeros for theta matrix doesn't work with neural network. When we backpropogate, the optimal values will update to the same values for all nodes. </p>

<p>Briefly, we initialize each theta with a random value between [-epsilon , epsilon]. Using this formula guarantees that we get the desired bound. We can apply the same technique to multi-dimentional J(theta) matrix. </p>

<pre><code>If the dimensions of Theta1 is 10x11, Theta2 is 10x11 and Theta3 is 1x11.

Theta1 = rand(10,11) * (2 * INIT_EPSILON) - INIT_EPSILON;  
Theta2 = rand(10,11) * (2 * INIT_EPSILON) - INIT_EPSILON;  
Theta3 = rand(1,11) * (2 * INIT_EPSILON) - INIT_EPSILON;  
</code></pre>

<hr>

<h3 id="puttingittogether">Putting it Together</h3>

<p>First, pick a network architecture; choose the layout of your neural network, including how many hidden units in each layer and how many layers in total you want to have.</p>

<ul>
<li>Number of input units = dimension of features x(i)</li>
<li>Number of output units = number of classes</li>
<li>Number of hidden units per layer = usually more the better (must balance with cost of computation as it increases with more hidden units)</li>
<li>Defaults: 1 hidden layer. If you have more than 1 hidden layer, then it is recommended that you have the same number of units in every hidden layer.</li>
</ul>

<p><strong>Training a Neural Network</strong></p>

<ol>
<li>Randomly initialize the weights  </li>
<li>Implement forward propagation to get hΘ(x(i)) for any x(i)  </li>
<li>Implement the cost function  </li>
<li>Implement backpropagation to compute partial derivatives  </li>
<li>Use gradient checking to confirm that your backpropagation works. Then disable gradient checking.  </li>
<li>Use gradient descent or a built-in optimization function to minimize the cost function with the weights in theta.</li>
</ol>

<pre><code>for i = 1:m,  
   Perform forward propagation and backpropagation using example (x(i),y(i))
   (Get activations a(l) and delta terms d(l) for l = 2,...,L
</code></pre>

<p><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/hGk18LsaEea7TQ6MHcgMPA_8de173808f362583eb39cdd0c89ef43e_Screen-Shot-2016-12-05-at-10.40.35-AM.png?expiry=1491091200000&amp;hmac=HbE_ZEpKeYD2TltrrYVU5OxTmXQd83nuso-WkozYsoM" alt=""></p>

<p>The image shows an intuition of how gradient descent works as we are implementing our neural network. The gradient descent algorithm keeps iterating and exploring the data pool until it reaches a local minimum where hΘ(x(i)) ~= y(i). The optimization process, as the the cost function is not convex, could only result in local minimum instead getting to the global optimum, but it normally doesn't cause huge problem in practice.</p>

<hr>

<h3 id="summarization">Summarization</h3>

<ul>
<li>Cost function - J(theta)</li>
</ul>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-3.07.59-PM-1.png" alt=""></p>

<pre><code>J = (1/m) .* sum ( sum ((-yk) .* log(h_theta)  -  (1-yk) .* log(1-h_theta) )) + ...  
    lambda ./ (2 * m)  .* (sum(sum(Theta1(:, 2:end) .* Theta1(:, 2:end))) + ...
    sum(sum(Theta2(:, 2:end) .* Theta2(:, 2:end))))
</code></pre>

<ul>
<li>Forward propagation</li>
</ul>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-7.00.04-PM.png" alt=""></p>

<ul>
<li>Backward propagation</li>
</ul>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-3.20.34-PM-1.png" alt=""></p>

<p>The intuition behind the backward propagation can be described as: given dataset of training sample (Xt, Yt), we first calculate the activations of the whole neural network via forward propagation, including those for neural units in each hidden layer and of output value for h(theta). We then compute the error terms that reflect how much of that node was 'responsible' for any errors in our output. Concretely, for the output layer the error terms can be directly measured by subtracting actual value from network's activations. For the hidden units, the error terms in layer L can be computed based on weighted average of the error terms of the nodes in layer L + 1, that can be expressed as an equation that involves multiplication of matrix of theta, error terms of next layer and sigmoid gradient.</p>

<p><em>Sigmoid gradient</em></p>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-3.15.56-PM-1.png" alt=""></p>

<p><em>Random initialization</em></p>

<pre><code>% Randomly initialize the weights to small values
% epsilon_init = sqrt(6)/(sqrt(L_in) + sqrt(L_out))
epsilon init = 0.12;  
W = rand(L out, 1 + L in) * 2 * epsilon init − epsilon init;  
</code></pre>

<ul>
<li>Backward propagation implementation</li>
</ul>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-9.49.30-PM.png" alt=""></p>

<p>1) Use loop function over training samples and compute the activations for each layer, namely values of z and a. Note that an all-one term needs be added to the vectors of activations to include the bias unit in each layer. </p>

<p>2) Calculate the delta value(errors) for output layer by measuring the difference between the activation and true value. </p>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-9.37.16-PM.png" alt=""></p>

<p>3) Calculate the error terms, namely the delta value, for hidden layer as follows:</p>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-9.40.31-PM.png" alt=""></p>

<p>4) Compute the accumulated gradient for given sample using the following formulas, where the delta2_0 is skipped or removed. </p>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-9.45.06-PM.png" alt=""></p>

<p>5) The gradient for the neural network cost function can then be obtained by dividing the accumulated gradients by 1/m:</p>

<p><img src="../../../../content/images/2017/04/Screen-Shot-2017-04-12-at-9.46.51-PM.png" alt=""></p>
          </div>
          <footer class="post-footer">
            <div itemprop="author" itemscope itemtype="http://schema.org/Person" class="post-author">
              <div class="post-author-info">
                <h4 class="post-footer-heading">Written By</h4>
                <a href="index.html" itemprop="url" class="post-author-name">
                  <span itemprop="name">Dong Liang</span>
                </a>
                <p itemprop="description" class="post-author-bio"></p>
                <p class="post-info">
                  <b class="post-info-title">Published on</b>
                  <time class="post-date">March 24, 2017</time>
                </p>
              </div>
            </div>
            <div class="post-social">
              <h4 class="post-footer-heading">Spread the word</h4>
              <a href="index.html#" data-action="share-twitter"><i class="fa fa-fw fa-lg fa-twitter"></i></a>
              <a href="index.html#" data-action="share-facebook"><i class="fa fa-fw fa-lg fa-facebook"></i></a>
              <a href="index.html#" data-action="share-gplus"><i class="fa fa-fw fa-lg fa-google-plus"></i></a>
            </div>
          </footer>
        </section>
      <section itemprop="comment" class="post-comments">
        <div id="disqus_thread"></div>
      </section>
    </article>

    <footer role="contentinfo" class="footer">
  <p><small>© 2017. All Rights Reserved.</small></p>
  <p><small><a href="http://ghostium.oswaldoacauan.com/" target="_blank">Ghostium Theme</a> by <a href="http://twitter.com/oswaldoacauan" target="_blank">@oswaldoacauan</a></small></p>
  <p><small>Proudly published with <a href="http://ghost.org" target="_blank">Ghost</a></small></p>
</footer>
  </div>
</section>

<script type="text/javascript">
  if(GHOSTIUM.haveDisqus) {
    var disqus_identifier = '9';

    if(typeof DISQUS !== 'object') {
      (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
      }());
    }
  } else {
    document.querySelector('.post-comments').remove();
  }
</script>

          </div>
        </div>
      </div>
    </main>

    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/github.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <script src="../../../../assets/js/foot-scripts.min.js?v=3e6e4834d0"></script>

    <script type="text/javascript">

      if(GHOSTIUM.haveGA) {
        (function(g,h,o,s,t,z){g.GoogleAnalyticsObject=s;g[s]||(g[s]=
        function(){(g[s].q=g[s].q||[]).push(arguments)});g[s].s=+new Date;
        t=h.createElement(o);z=h.getElementsByTagName(o)[0];
        t.src='//www.google-analytics.com/analytics.js';
        z.parentNode.insertBefore(t,z)}(window,document,'script','ga'));
        ga('create',ga_ua);ga('send','pageview');
      }

      if(GHOSTIUM.haveDisqus) {
        (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
      }
    </script>
  </body>
